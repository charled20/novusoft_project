{% from "components/variables.njk" import defaults %}

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.8/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.8/firebase-auth.js";

  // Firebase configuration
  const firebaseConfig = {
    apiKey: "{{ defaults.firebase_config.apiKey }}",
    authDomain: "{{ defaults.firebase_config.authDomain }}",
    projectId: "{{ defaults.firebase_config.projectId }}",
    storageBucket: "{{ defaults.firebase_config.storageBucket }}",
    messagingSenderId: "{{ defaults.firebase_config.messagingSenderId }}",
    appId: "{{ defaults.firebase_config.appId }}",
  };

  // Initialize Firebase instance
  const firebaseInstance = initializeApp(firebaseConfig);

  // Get auth instance
  const firebaseAuth = getAuth();

  // Set auth observer
  onAuthStateChanged(firebaseAuth, (user) => {

    // Check user is logged in
    if (user) {
      
      // Store user id to local storage
      localStorage.setItem("firebase_user_id", user.uid);
    } else {

      // Store user id to local storage
      localStorage.removeItem("firebase_user_id");
    }
  });
  
  // Inject Firebase instance to window object
  window.firebase = firebaseInstance;
  window.firebaseAuth = firebaseAuth;
</script>